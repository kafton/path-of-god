name: run-ai

on:
  workflow_dispatch:

permissions:
  contents: write

jobs:
  self_rewrite:
    runs-on: ubuntu-latest

    steps:
      # STEP 1 — CHECKOUT WITH WRITE TOKEN
      - name: Checkout repository
        uses: actions/checkout@v4
        with:
          token: ${{ secrets.GITHUB_TOKEN }}

      # STEP 2 — SETUP PYTHON
      - name: Setup Python
        uses: actions/setup-python@v4
        with:
          python-version: "3.10"

      # STEP 3 — RUN THE AI SCRIPT
      - name: Run AI Self-Rewriter
        run: |
          python3 self_rewriting_ai.py

      # STEP 4 — CONFIGURE GIT
      - name: Setup Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      # STEP 5 — COMMIT CHANGES
      - name: Commit changes
        run: |
          git add .
          git commit -m "AI updated its own code [skip ci]" || echo "No changes to commit"

      # STEP 6 — PUSH CHANGES
      - name: Push changes
        run: |
          git push origin main
